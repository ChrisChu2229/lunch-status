<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Mr. Chu — Lunch Availability</title>
  <style>
    :root { --bg: #111; --fg: #fff; --muted:#bbb; }
    html,body{margin:0;height:100%}
    body{
      display:flex;align-items:center;justify-content:center;flex-direction:column;
      background:var(--bg);color:var(--fg);font:700 6vw/1.1 system-ui,-apple-system,Segoe UI,Roboto,Arial;
      text-align:center;transition:background .2s ease;
    }
    .dot{width:18vw;height:18vw;max-width:220px;max-height:220px;border-radius:50%;margin-bottom:1rem;box-shadow:0 0 24px rgba(0,0,0,.25)}
    .sub{font:400 2.8vw/1.3 system-ui,-apple-system,Segoe UI,Roboto,Arial;color:var(--muted);margin-top:1rem}
    .time{font:400 1.8vw/1.3 system-ui,-apple-system,Segoe UI,Roboto,Arial;color:#ddd;margin-top:1rem}
    .admin{position:fixed;inset:auto 1rem 1rem auto;max-width:min(92vw,420px);background:#1f2937;color:#fff;padding:12px;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.35);display:none;gap:.5rem}
    .admin input, .admin button{font:16px;padding:8px;border-radius:10px;border:0}
    .admin input{flex:1;min-width:0}
    .admin .row{display:flex;gap:.5rem;margin-top:.5rem}
    .admin .note{font-size:12px;color:#cbd5e1;margin-top:.25rem}
    @media (max-width:640px){ body{font-size:10vw}.sub{font-size:5vw}.time{font-size:4vw} }
  </style>
</head>
<body>
  <div class="dot" id="dot"></div>
  <div id="statusText">Loading…</div>
  <div class="sub" id="message"></div>
  <div class="time" id="updated"></div>

  <!-- Admin helper (revealed with ?admin=1) -->
  <div class="admin" id="admin">
    <div><strong>Admin</strong> — edit opens GitHub; paste + commit.</div>
    <div class="row">
      <input id="msg" placeholder="Optional message (e.g., Quiet coding)"/>
    </div>
    <div class="row">
      <button id="btnGreen">Set AVAILABLE (Green)</button>
      <button id="btnRed">Set NOT Available (Red)</button>
    </div>
    <div class="note">Tip: After it opens GitHub, press <b>Ctrl/Cmd+V</b> to paste, then <b>Commit changes</b>.</div>
  </div>

  <script>
    // ⬇️ CHANGE THIS TO YOUR EDIT URL after you create the repo:
    // Example: https://github.com/YOURUSER/lunch-status/edit/main/status.json
    const GITHUB_EDIT_URL = "https://github.com/YOURUSER/lunch-status/edit/main/status.json";

    function render(data){
      const available = !!data.available;
      const color = available ? '#0f9d58' : '#d93025'; // green/red
      const bg = available ? '#052e1d' : '#3a0b08';
      document.documentElement.style.setProperty('--bg', bg);
      document.getElementById('dot').style.background = color;
      document.getElementById('statusText').textContent = available ? "✅ I am AVAILABLE" : "⛔ I am NOT available";
      document.getElementById('message').textContent = data.message || (available ? "Come on in!" : "Try another day or email me.");
      const ts = data.updated || new Date().toISOString();
      document.getElementById('updated').textContent = "Updated: " + new Date(ts).toLocaleString();
    }

    async function load(){
      try{
        const res = await fetch('status.json?t='+Date.now(), { cache: 'no-store' });
        const data = await res.json();
        render(data);
      }catch{
        render({ available:false, message:"Couldn’t load status.json", updated:new Date().toISOString() });
      }
    }
    load(); setInterval(load, 30000);

    // Admin helper
    const params = new URLSearchParams(location.search);
    if (params.get('admin')) {
      const admin = document.getElementById('admin');
      admin.style.display = 'block';
      const msgEl = document.getElementById('msg');

      async function setStatus(available){
        const payload = {
          available,
          message: msgEl.value.trim() || (available ? "Come on in!" : "Try another day or email me."),
          updated: new Date().toISOString()
        };
        const json = JSON.stringify(payload, null, 2);
        try { await navigator.clipboard.writeText(json); } catch {}
        window.open(GITHUB_EDIT_URL, '_blank'); // paste + commit
      }

      document.getElementById('btnGreen').onclick = () => setStatus(true);
      document.getElementById('btnRed').onclick = () => setStatus(false);
    }
  </script>
</body>
</html>
